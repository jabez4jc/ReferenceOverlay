<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Overlay — Control</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <link rel="icon" type="image/png" href="assets/brand/favicon-32.png" sizes="32x32" />
  <link rel="apple-touch-icon" href="assets/brand/apple-touch-icon.png" />
  <!-- Google Fonts: Display, Elegant Serif, and Modern Sans options -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Cinzel:wght@400;700&family=Cinzel+Decorative:wght@400;700&family=Cormorant+Garamond:wght@400;700&family=Crimson+Pro:wght@400;700&family=EB+Garamond:wght@400;700&family=Josefin+Sans:wght@400;700&family=Libre+Baskerville:wght@400;700&family=Lora:wght@400;700&family=Merriweather:wght@400;700&family=Montserrat:wght@400;700&family=Oswald:wght@400;700&family=Playfair+Display:wght@400;700&family=Raleway:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/control.css" />
</head>
<body>

<div class="app">

  <!-- ── Header ──────────────────────────────────────────────────────────── -->
  <header class="app-header">
    <div class="header-left">
      <img class="logo-icon" src="assets/brand/reference-overlay-mark.svg" alt="Overlay logo" />
      <h1>Overlay</h1>
    </div>
    <div class="header-right">
      <span id="status-pill" class="status-pill status-off">OFF AIR</span>
      <span id="ws-indicator" class="ws-indicator" data-state="offline" title="WebSocket server not running"></span>
      <button class="btn-session" id="btn-new-session" onclick="openNewSession()" title="Open a fresh independent session in a new tab">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        New Session
      </button>
      <button class="btn-output-link" id="btn-open-output" onclick="openOutputWindow()" title="Open output window (click again for additional outputs)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
        Output Window
      </button>
    </div>
  </header>

  <!-- ── Mode Toggle ──────────────────────────────────────────────────────── -->
  <div class="mode-toggle">
    <button id="tab-bible" class="mode-tab active" onclick="setMode('bible')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
      Bible Reference
    </button>
    <button id="tab-speaker" class="mode-tab" onclick="setMode('speaker')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      Speaker
    </button>
  </div>

  <!-- ── Main Content ─────────────────────────────────────────────────────── -->
  <main class="app-main">

    <!-- ── Bible Reference Panel ──────────────────────────────────────────── -->
    <section id="panel-bible" class="panel">
      <div class="field-grid">

        <div class="field-group span-2">
          <label for="book">Book</label>
          <select id="book" onchange="onBookChange()">
            <optgroup label="Old Testament" id="optgroup-ot"></optgroup>
            <optgroup label="New Testament" id="optgroup-nt"></optgroup>
          </select>
        </div>

        <div class="field-group">
          <label for="chapter">Chapter</label>
          <select id="chapter" onchange="onBibleChange()"></select>
        </div>

        <div class="field-group span-full">
          <label for="verse-ref">
            Verse(s)
            <span class="label-hint">e.g. 19 &nbsp;·&nbsp; 19-21 &nbsp;·&nbsp; 19, 22 &nbsp;·&nbsp; 19-21, 25</span>
          </label>
          <input type="text" id="verse-ref" placeholder="e.g. 19 or 19-21 or 19-21, 25"
                 onchange="onBibleChange()" oninput="onBibleChange()" />
          <div id="verse-validation" class="verse-validation"></div>
        </div>

        <div class="field-group span-full">
          <label for="translation">Translation</label>
          <select id="translation" onchange="onBibleChange()"></select>
        </div>

        <!-- ── Verse Text Lookup ─────────────────────────────────────────── -->
        <div class="field-group span-full">
          <div class="lookup-bar">
            <button class="btn-lookup" onclick="lookupVerse()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
              Look Up Text
            </button>
            <span id="lookup-status" class="lookup-status"></span>
          </div>
          <div id="verse-text-box" class="verse-text-box" style="display:none">
            <p id="verse-text-content" class="verse-text-content"></p>
            <label class="verse-text-include">
              <input type="checkbox" id="include-verse-text" onchange="updatePreview()" />
              Use verse text as line 2 in output
            </label>
          </div>
        </div>

      </div>
    </section>

    <!-- ── Speaker Panel ──────────────────────────────────────────────────── -->
    <section id="panel-speaker" class="panel hidden">
      <div class="field-grid">

        <div class="field-group span-full">
          <label for="speaker-name">Speaker Name</label>
          <input type="text" id="speaker-name"
                 placeholder="e.g. Suresh Abraham"
                 onchange="onSpeakerChange()" oninput="onSpeakerChange()" />
        </div>

        <div class="field-group span-full">
          <label for="speaker-title">
            Title / Role
            <span class="label-hint">optional</span>
          </label>
          <input type="text" id="speaker-title"
                 placeholder="e.g. Senior Pastor"
                 onchange="onSpeakerChange()" oninput="onSpeakerChange()" />
        </div>

      </div>
    </section>

    <!-- ── Preview ────────────────────────────────────────────────────────── -->
    <section class="preview-section">
      <div class="preview-label">Preview</div>
      <div class="preview-viewport">
        <div class="preview-bg"></div>
        <!-- Standard lower-third preview (hidden when custom template is active) -->
        <div class="lower-third-wrap" id="preview-wrap">
          <div class="lower-third" id="preview-lower-third">
            <div class="lt-accent"></div>
            <img class="lt-logo hidden" id="preview-logo" alt="Logo" />
            <div class="lt-text">
              <div class="lt-line1" id="preview-line1">Revelation 3:19</div>
              <div class="lt-line2" id="preview-line2">King James Version</div>
            </div>
          </div>
        </div>
        <!-- Custom template preview (shown when custom template is enabled) -->
        <div class="preview-custom-wrap" id="preview-custom-wrap" style="display:none">
          <div id="preview-custom"></div>
        </div>
      </div>
    </section>

    <!-- ── Presets ────────────────────────────────────────────────────────── -->
    <section class="presets-section">
      <div class="presets-header">
        <span class="presets-label">Presets</span>
        <button class="btn-save-preset" onclick="saveCurrentPreset()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
          Save Current
        </button>
      </div>
      <div class="presets-list" id="presets-list">
        <span class="presets-empty" id="presets-empty">No presets saved — click Save Current to add one</span>
      </div>
    </section>

    <!-- ── Action Buttons ─────────────────────────────────────────────────── -->
    <section class="actions">
      <button class="btn-show" id="btn-show" onclick="sendShow()">
        <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
        SHOW
      </button>
      <button class="btn-clear" id="btn-clear" onclick="sendClear()">
        <svg viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
        CLEAR
      </button>
    </section>

    <!-- ── Settings ───────────────────────────────────────────────────────── -->
    <details class="settings-panel">
      <summary>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M4.93 4.93a10 10 0 0 0 0 14.14"/><path d="M12 2v2M12 20v2M2 12h2M20 12h2"/></svg>
        Settings
      </summary>
      <div class="settings-body">

        <!-- Chroma Key -->
        <div class="setting-row">
          <div class="setting-group span-full">
            <label class="setting-label">Chroma Key Background</label>
            <div class="chroma-options">
              <label class="chroma-opt">
                <input type="radio" name="chroma" value="#0000FF" checked onchange="onSettingsChange()" />
                <span class="chroma-swatch" style="background:#0000FF;"></span>
                Blue
              </label>
              <label class="chroma-opt">
                <input type="radio" name="chroma" value="#00B140" onchange="onSettingsChange()" />
                <span class="chroma-swatch" style="background:#00B140;"></span>
                Green
              </label>
              <label class="chroma-opt">
                <input type="radio" name="chroma" value="#FF00FF" onchange="onSettingsChange()" />
                <span class="chroma-swatch" style="background:#FF00FF;"></span>
                Magenta
              </label>
              <label class="chroma-opt custom-chroma-opt">
                <input type="radio" name="chroma" value="custom" onchange="onSettingsChange()" />
                <input type="color" id="custom-chroma-color" value="#0047AB"
                       oninput="onCustomChromaChange()" onchange="onCustomChromaChange()" />
                Custom
              </label>
            </div>
          </div>
        </div>

        <!-- Animation + Style -->
        <div class="setting-row">
          <div class="setting-group">
            <label class="setting-label" for="anim-select">Animation</label>
            <select id="anim-select" onchange="onSettingsChange()">
              <option value="fade">Fade</option>
              <option value="slide">Slide Up</option>
              <option value="none">None (Instant)</option>
            </select>
          </div>

          <div class="setting-group">
            <label class="setting-label" for="style-select">Lower Third Style</label>
            <select id="style-select" onchange="onSettingsChange()">
              <option value="classic">Classic — Dark bar</option>
              <option value="accent">Accent line</option>
              <option value="minimal">Minimal — text only</option>
              <option value="outline">Outlined text</option>
              <option value="gradient">Gradient fade</option>
              <option value="solid">Solid — Accent fill</option>
              <option value="split">Split lines</option>
              <option value="frosted">Frosted glass</option>
            </select>
          </div>
        </div>

        <!-- Accent Color + Position -->
        <div class="setting-row">
          <div class="setting-group">
            <label class="setting-label" for="accent-color">Accent Color</label>
            <input type="color" id="accent-color" value="#C8A951" onchange="onSettingsChange()" />
          </div>

          <div class="setting-group">
            <label class="setting-label" for="position-select">Position</label>
            <select id="position-select" onchange="onSettingsChange()">
              <option value="lower">Lower Third</option>
              <option value="upper">Upper Third</option>
              <option value="center">Centered</option>
            </select>
          </div>
        </div>

        <!-- Text Alignment -->
        <div class="setting-row">
          <div class="setting-group span-full">
            <label class="setting-label">Text Alignment</label>
            <div class="align-options">
              <label class="align-opt">
                <input type="radio" name="textAlign" value="left" onchange="onSettingsChange()" />
                <svg viewBox="0 0 20 14" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><line x1="1" y1="2" x2="19" y2="2"/><line x1="1" y1="7" x2="13" y2="7"/><line x1="1" y1="12" x2="16" y2="12"/></svg>
                Left
              </label>
              <label class="align-opt">
                <input type="radio" name="textAlign" value="center" checked onchange="onSettingsChange()" />
                <svg viewBox="0 0 20 14" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><line x1="1" y1="2" x2="19" y2="2"/><line x1="4" y1="7" x2="16" y2="7"/><line x1="2" y1="12" x2="18" y2="12"/></svg>
                Center
              </label>
              <label class="align-opt">
                <input type="radio" name="textAlign" value="right" onchange="onSettingsChange()" />
                <svg viewBox="0 0 20 14" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"><line x1="1" y1="2" x2="19" y2="2"/><line x1="7" y1="7" x2="19" y2="7"/><line x1="4" y1="12" x2="19" y2="12"/></svg>
                Right
              </label>
            </div>
          </div>
        </div>

        <!-- Font + Resolution -->
        <div class="setting-row">
          <div class="setting-group">
            <label class="setting-label" for="font-select">Font</label>
            <select id="font-select" onchange="onSettingsChange()">
              <!-- populated by JS from FONT_OPTIONS -->
            </select>
          </div>

          <div class="setting-group">
            <label class="setting-label" for="output-res">Output Resolution</label>
            <select id="output-res" onchange="onSettingsChange()">
              <option value="1920x1080">1920 × 1080 (Full HD)</option>
              <option value="1280x720">1280 × 720 (HD)</option>
              <option value="3840x2160">3840 × 2160 (4K UHD)</option>
            </select>
          </div>
        </div>

        <!-- Lower Third Background Image -->
        <div class="setting-row">
          <div class="setting-group span-full">
            <label class="setting-label">Lower Third Background Image</label>
            <div class="file-row">
              <label class="file-btn" for="lt-bg-file">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                Choose Image
                <input type="file" id="lt-bg-file" accept="image/*" onchange="onLtBgChange()" />
              </label>
              <button class="file-clear-btn" id="lt-bg-clear" onclick="clearLtBg()" style="display:none">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                Clear
              </button>
              <span class="file-name" id="lt-bg-name">No image selected</span>
            </div>
            <div class="file-preview-wrap" id="lt-bg-preview-wrap" style="display:none">
              <img id="lt-bg-preview" class="file-preview-img" alt="Lower third background preview" />
            </div>
          </div>
        </div>

        <!-- Logo -->
        <div class="setting-row">
          <div class="setting-group span-full">
            <label class="setting-label">Logo (PNG with transparency)</label>
            <div class="file-row">
              <label class="file-btn" for="logo-file">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                Choose Logo
                <input type="file" id="logo-file" accept="image/png,image/svg+xml,image/*" onchange="onLogoChange()" />
              </label>
              <button class="file-clear-btn" id="logo-clear" onclick="clearLogo()" style="display:none">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                Clear
              </button>
              <span class="file-name" id="logo-name">No logo selected</span>
            </div>
            <div class="logo-controls" id="logo-controls" style="display:none">
              <div class="logo-preview-wrap">
                <img id="logo-preview" class="logo-preview-img" alt="Logo preview" />
              </div>
              <div class="setting-group">
                <label class="setting-label" for="logo-position">Logo Position</label>
                <select id="logo-position" onchange="onSettingsChange()">
                  <option value="left">Left side</option>
                  <option value="right">Right side</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Custom Lower-Third Template Editor -->
        <div class="setting-row">
          <div class="setting-group span-full">
            <label class="setting-label template-section-label">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
              Custom HTML Template
            </label>
            <div class="template-enable-row">
              <label class="template-toggle-label">
                <input type="checkbox" id="use-custom-template" onchange="onSettingsChange()" />
                Enable custom template (overrides all style settings)
              </label>
              <button class="btn-reset-template" onclick="resetTemplate()">Load Example</button>
            </div>
            <div class="template-fields">
              <div class="template-field-group">
                <label class="setting-label">HTML
                  <span class="label-hint">Variables: &#123;&#123;line1&#125;&#125; &#123;&#123;line2&#125;&#125; &#123;&#123;accentColor&#125;&#125; &#123;&#123;font&#125;&#125;</span>
                </label>
                <textarea id="template-html" class="template-textarea" rows="6"
                  onchange="onSettingsChange()" oninput="onSettingsChange()"
                  placeholder="<div class=&quot;my-lt&quot;>&#10;  <div class=&quot;line1&quot;>{{line1}}</div>&#10;</div>"></textarea>
              </div>
              <div class="template-field-group">
                <label class="setting-label">CSS</label>
                <textarea id="template-css" class="template-textarea" rows="8"
                  onchange="onSettingsChange()" oninput="onSettingsChange()"
                  placeholder=".my-lt { background: rgba(0,0,0,.85); padding: 20px; }"></textarea>
              </div>
            </div>
          </div>
        </div>

      </div>
    </details>

    <!-- ── Keyboard Shortcut Hint ─────────────────────────────────────────── -->
    <div class="kbd-hint">
      <kbd>Enter</kbd> Show &nbsp;·&nbsp; <kbd>Esc</kbd> Clear &nbsp;·&nbsp; <kbd>B</kbd> Bible &nbsp;·&nbsp; <kbd>S</kbd> Speaker
    </div>

  </main>
</div>

<script src="js/data.js"></script>
<script src="js/control.js"></script>
</body>
</html>
